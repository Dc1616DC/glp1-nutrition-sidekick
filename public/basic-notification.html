<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Browser Notification Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #4A90E2;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            font-weight: bold;
            margin: 10px 0;
        }
        .granted { color: #4CAF50; }
        .denied { color: #F44336; }
        .default { color: #FF9800; }
        .unsupported { color: #9E9E9E; }
        button {
            background-color: #4A90E2;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px 0;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #357ABD;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .log {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
        }
        .log-entry {
            margin: 5px 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .error { color: #F44336; }
        .success { color: #4CAF50; }
        .info { color: #2196F3; }
    </style>
</head>
<body>
    <h1>Basic Browser Notification Test</h1>
    <p>This page tests basic browser notifications without using Firebase or any other external services.</p>
    
    <div class="card">
        <h2>Browser Support</h2>
        <div id="support-status"></div>
    </div>

    <div class="card">
        <h2>Notification Permission</h2>
        <div class="status">Current status: <span id="permission-status">checking...</span></div>
        <button id="request-permission" disabled>Request Permission</button>
    </div>

    <div class="card">
        <h2>Test Notification</h2>
        <button id="send-notification" disabled>Send Test Notification</button>
        <div>
            <label for="notification-title">Title:</label>
            <input type="text" id="notification-title" value="Test Notification" />
        </div>
        <div>
            <label for="notification-body">Message:</label>
            <input type="text" id="notification-body" value="This is a test notification from GLP-1 Nutrition Companion" />
        </div>
    </div>

    <div class="log" id="log">
        <div class="log-entry info">Log initialized</div>
    </div>

    <script>
        // DOM elements
        const supportStatus = document.getElementById('support-status');
        const permissionStatus = document.getElementById('permission-status');
        const requestPermissionBtn = document.getElementById('request-permission');
        const sendNotificationBtn = document.getElementById('send-notification');
        const notificationTitle = document.getElementById('notification-title');
        const notificationBody = document.getElementById('notification-body');
        const logElement = document.getElementById('log');

        // Log function
        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            logElement.prepend(entry);
        }

        // Check if notifications are supported
        function checkNotificationSupport() {
            if (!('Notification' in window)) {
                supportStatus.innerHTML = '<span class="unsupported">❌ Notifications are NOT supported in this browser</span>';
                log('Notifications are NOT supported in this browser', 'error');
                return false;
            }
            
            supportStatus.innerHTML = '<span class="granted">✅ Notifications are supported in this browser</span>';
            log('Notifications are supported in this browser', 'success');
            return true;
        }

        // Update permission status display
        function updatePermissionStatus() {
            if (!('Notification' in window)) {
                permissionStatus.textContent = 'unsupported';
                permissionStatus.className = 'unsupported';
                return;
            }
            
            const permission = Notification.permission;
            permissionStatus.textContent = permission;
            permissionStatus.className = permission;
            
            // Enable/disable buttons based on permission
            if (permission === 'granted') {
                sendNotificationBtn.disabled = false;
                requestPermissionBtn.disabled = true;
                log('Notification permission is granted', 'success');
            } else if (permission === 'denied') {
                sendNotificationBtn.disabled = true;
                requestPermissionBtn.disabled = true;
                log('Notification permission is denied. You need to unblock notifications in browser settings.', 'error');
            } else {
                // default
                sendNotificationBtn.disabled = true;
                requestPermissionBtn.disabled = false;
                log('Notification permission not yet requested or is in "default" state', 'info');
            }
        }

        // Request notification permission
        async function requestPermission() {
            try {
                log('Requesting notification permission...', 'info');
                const permission = await Notification.requestPermission();
                log(`Permission request result: ${permission}`, permission === 'granted' ? 'success' : 'error');
                updatePermissionStatus();
            } catch (error) {
                log(`Error requesting permission: ${error.message}`, 'error');
                console.error('Error requesting permission:', error);
            }
        }

        // Send a test notification
        function sendTestNotification() {
            try {
                const title = notificationTitle.value || 'Test Notification';
                const body = notificationBody.value || 'This is a test notification';
                
                log(`Sending notification: "${title}"`, 'info');
                
                const notification = new Notification(title, {
                    body: body,
                    icon: '/icons/icon-192x192.png',
                    badge: '/icons/icon-192x192.png',
                    tag: 'test-notification',
                    timestamp: Date.now(),
                    requireInteraction: true
                });
                
                notification.onclick = function() {
                    log('Notification was clicked', 'info');
                    window.focus();
                    notification.close();
                };
                
                log('Notification sent successfully', 'success');
            } catch (error) {
                log(`Error sending notification: ${error.message}`, 'error');
                console.error('Error sending notification:', error);
            }
        }

        // Initialize
        function init() {
            log('Initializing notification test page...', 'info');
            
            const isSupported = checkNotificationSupport();
            if (isSupported) {
                updatePermissionStatus();
                
                // Set up event listeners
                requestPermissionBtn.addEventListener('click', requestPermission);
                sendNotificationBtn.addEventListener('click', sendTestNotification);
                requestPermissionBtn.disabled = false;
            } else {
                requestPermissionBtn.disabled = true;
                sendNotificationBtn.disabled = true;
            }
            
            log('Initialization complete', 'success');
        }

        // Run initialization
        init();
    </script>
</body>
</html>
